# Jitsi (Self-Host Cost Calculation

> This doc is generated by ClaudeAI.

**Requirements:** 100 sessions/month, 500 participants per session, 25 active speakers, 4 streams per viewer, 120 minutes per session

---

## Jitsi Architecture Components

Jitsi has a more complex architecture than LiveKit:

1. **Jitsi Videobridge (JVB)** - Media routing (SFU)
2. **Jicofo** - Conference focus/coordinator
3. **Prosody** - XMPP signaling server
4. **Nginx** - Web server for frontend
5. **TURN servers** - NAT traversal

---

## Compute Engine Machine Type Selection

### **1. Jitsi Videobridge (JVB) - n2-standard-8**

**Specifications:**
- **vCPUs:** 8
- **Memory:** 32 GB RAM
- **Price:** $0.3499/hour
- **Network:** Up to 16 Gbps

**Why n2-standard-8 for JVB?**

Similar to LiveKit media servers, JVB is an SFU that forwards streams.

**Capacity per instance:**
- **Active senders:** 100-150 concurrent
- **Stream forwards:** 2,000-2,500 concurrent (slightly lower than LiveKit due to JVB overhead)
- **Participants:** 200-300 total participants

**For your use case (per room):**
- 25 senders
- 475 viewers × 4 streams = 1,900 stream forwards
- 3.1 Gbps bandwidth per room

**Rooms per JVB instance:**
- By forwards: 2,500 ÷ 1,900 = **1.3 rooms max** ← **Bottleneck**
- By bandwidth: 10 Gbps ÷ 3.1 Gbps = **3.2 rooms max**
- **Safe capacity: 1-2 rooms per instance**

**For 100 concurrent rooms:**
- 100 rooms ÷ 1.5 = **67 instances minimum**
- With 3 regions: 23 per region
- **With 30% buffer: 30 JVB instances per region**
- **Total: 90 JVB instances**

---

### **2. Jicofo (Conference Focus) - e2-medium**

**Specifications:**
- **vCPUs:** 2 (shared-core)
- **Memory:** 4 GB RAM
- **Price:** $0.0335/hour
- **Network:** Up to 2 Gbps

**Why e2-medium for Jicofo?**

Jicofo handles:
- Conference room logic
- Participant join/leave coordination
- Load distribution to JVBs
- Does NOT handle media (lightweight)

**Capacity per instance:**
- Can manage 50-100 concurrent conferences
- Very light CPU/memory usage
- Mainly I/O bound (database queries, XMPP messages)

**For 100 concurrent rooms:**
- Need 2-3 instances for redundancy
- **Per region: 1 instance (with 1-2 backups)**
- **Total: 3-6 instances across 3 regions**

**Using 2 per region for HA = 6 instances total**

---

### **3. Prosody (XMPP Server) - e2-standard-2**

**Specifications:**
- **vCPUs:** 2
- **Memory:** 8 GB RAM
- **Price:** $0.0670/hour
- **Network:** Up to 4 Gbps

**Why e2-standard-2 for Prosody?**

Prosody handles:
- XMPP signaling for all participants
- Presence notifications
- Chat messages
- Authentication

**Capacity per instance:**
- 5,000-10,000 concurrent connections
- Memory-bound (keeps connection state)

**For your use case:**
- 100 rooms × 500 participants = **50,000 total connections**
- Per region (33 rooms): ~16,500 connections
- 16,500 ÷ 7,500 = **~2-3 instances per region**

**With redundancy: 3-4 instances per region**
**Total: 9-12 instances across 3 regions**

**Using 4 per region = 12 instances total**

---

### **4. Nginx (Web Server) - e2-small**

**Specifications:**
- **vCPUs:** 2 (shared-core)
- **Memory:** 2 GB RAM
- **Price:** $0.0168/hour
- **Network:** Up to 1 Gbps

**Why e2-small for Nginx?**

Nginx serves:
- Static web assets (HTML/JS/CSS)
- Reverse proxy for signaling
- Most traffic goes through Cloud CDN (not directly to Nginx)

**Capacity per instance:**
- Can serve 1,000+ concurrent connections for static assets
- Behind Cloud Load Balancer

**For 100 concurrent rooms:**
- **2 instances per region** (for HA)
- **Total: 6 instances across 3 regions**

---

### **5. TURN Servers - n2-standard-4**

Same as LiveKit calculation:
- **18 instances at peak** (6 per region)
- **3 instances baseline** (1 per region)

---

## Jitsi Component Summary

| Component | Machine Type | Instances (Peak) | Instances (Baseline) | Role |
|-----------|--------------|------------------|----------------------|------|
| **Jitsi Videobridge (JVB)** | n2-standard-8 | 90 (30/region) | 6 (2/region) | Media forwarding (SFU) |
| **Jicofo** | e2-medium | 6 (2/region) | 6 (2/region) | Conference coordinator |
| **Prosody** | e2-standard-2 | 12 (4/region) | 12 (4/region) | XMPP signaling |
| **Nginx** | e2-small | 6 (2/region) | 6 (2/region) | Web server |
| **TURN** | n2-standard-4 | 18 (6/region) | 3 (1/region) | NAT traversal |

**Note:** Jicofo, Prosody, and Nginx run 24/7 (not auto-scaled) for stability.

---

# Scenario A: All 100 Sessions Concurrent (Once Per Month)

### Infrastructure Usage
- **Peak:** 2 hours with all components at peak
- **Idle:** 728 hours with baseline

### Compute Engine Details

**Jitsi Videobridge (n2-standard-8):**
- Peak: 90 instances × 2 hours = 180 hrs @ $0.3499 = **$63**
- Baseline: 6 instances × 728 hours = 4,368 hrs @ $0.3499 = **$1,529**
- **Subtotal: $1,592**

**Jicofo (e2-medium) - runs 24/7:**
- 6 instances × 730 hours @ $0.0335 = **$147**

**Prosody (e2-standard-2) - runs 24/7:**
- 12 instances × 730 hours @ $0.0670 = **$587**

**Nginx (e2-small) - runs 24/7:**
- 6 instances × 730 hours @ $0.0168 = **$74**

**TURN Servers (n2-standard-4):**
- Peak: 18 instances × 2 hours = 36 hrs @ $0.1749 = **$6**
- Baseline: 3 instances × 728 hours = 2,184 hrs @ $0.1749 = **$382**
- **Subtotal: $388**

### Monthly Costs

| Service | Machine Type | Cost | Notes |
|---------|--------------|------|-------|
| **Jitsi Videobridge (JVB)** | n2-standard-8 | **$1,592** | 90 peak + 6 baseline |
| **Jicofo** | e2-medium | **$147** | 6 instances, 24/7 |
| **Prosody** | e2-standard-2 | **$587** | 12 instances, 24/7 |
| **Nginx** | e2-small | **$74** | 6 instances, 24/7 |
| **TURN Servers** | n2-standard-4 | **$388** | 18 peak + 3 baseline |
| **Memorystore (Redis)** | Standard 5GB | **$318** | 3 regions, for JVB clustering |
| **Cloud SQL (PostgreSQL)** | db-n1-standard-2 | **$350** | Jicofo/Prosody data |
| **Load Balancing** | Network + App LB | **$160** | 3 regions |
| **Bandwidth (Egress)** | Premium Tier | **$20,520** | 273.6 TB @ $0.075/GB |
| **Cloud NAT** | - | **$99** | 3 regions |
| **Cloud DNS** | - | **$5** | Hosted zones |
| **Cloud Storage** | Multi-regional | **$10** | Recordings |
| **Monitoring & Logging** | - | **$30** | Monitoring |
| | | | |
| **GRAND TOTAL** | | **$24,280/month** | |

**Cost per session:** $242.80

---

# Scenario B: Sequential (~3 sessions/day, 6 hours peak)

### Compute Engine Details

**Jitsi Videobridge (n2-standard-8):**
- Peak: 75 instances × 6 hrs/day × 30 days = 13,500 hrs @ $0.3499 = **$4,724**
- Baseline: 6 instances × 18 hrs/day × 30 days = 3,240 hrs @ $0.3499 = **$1,134**
- **Subtotal: $5,858**

**Jicofo (e2-medium) - runs 24/7:**
- 6 instances × 730 hours @ $0.0335 = **$147**

**Prosody (e2-standard-2) - runs 24/7:**
- 12 instances × 730 hours @ $0.0670 = **$587**

**Nginx (e2-small) - runs 24/7:**
- 6 instances × 730 hours @ $0.0168 = **$74**

**TURN Servers (n2-standard-4):**
- Peak: 18 instances × 6 hrs/day × 30 days = 3,240 hrs @ $0.1749 = **$567**
- Baseline: 3 instances × 18 hrs/day × 30 days = 1,620 hrs @ $0.1749 = **$283**
- **Subtotal: $850**

### Monthly Costs

| Service | Machine Type | Cost | Notes |
|---------|--------------|------|-------|
| **Jitsi Videobridge (JVB)** | n2-standard-8 | **$5,858** | 75 peak + 6 baseline |
| **Jicofo** | e2-medium | **$147** | 6 instances, 24/7 |
| **Prosody** | e2-standard-2 | **$587** | 12 instances, 24/7 |
| **Nginx** | e2-small | **$74** | 6 instances, 24/7 |
| **TURN Servers** | n2-standard-4 | **$850** | 18 peak + 3 baseline |
| **Memorystore (Redis)** | Standard 5GB | **$318** | 3 regions |
| **Cloud SQL (PostgreSQL)** | db-n1-standard-2 | **$350** | Multi-regional |
| **Load Balancing** | Network + App LB | **$160** | 3 regions |
| **Bandwidth (Egress)** | Premium Tier | **$20,520** | 273.6 TB @ $0.075/GB |
| **Cloud NAT** | - | **$99** | 3 regions |
| **Cloud DNS** | - | **$5** | Hosted zones |
| **Cloud Storage** | Multi-regional | **$10** | Recordings |
| **Monitoring & Logging** | - | **$30** | Monitoring |
| | | | |
| **GRAND TOTAL** | | **$29,008/month** | |

**Cost per session:** $290.08

---

# Scenario C: Batched (10 sessions at a time, 10 batches/month)

### Compute Engine Details

**Jitsi Videobridge (n2-standard-8):**
- Peak: 75 instances × 20 hours = 1,500 hrs @ $0.3499 = **$525**
- Baseline: 6 instances × 710 hours = 4,260 hrs @ $0.3499 = **$1,491**
- **Subtotal: $2,016**

**Jicofo (e2-medium) - runs 24/7:**
- 6 instances × 730 hours @ $0.0335 = **$147**

**Prosody (e2-standard-2) - runs 24/7:**
- 12 instances × 730 hours @ $0.0670 = **$587**

**Nginx (e2-small) - runs 24/7:**
- 6 instances × 730 hours @ $0.0168 = **$74**

**TURN Servers (n2-standard-4):**
- Peak: 18 instances × 20 hours = 360 hrs @ $0.1749 = **$63**
- Baseline: 3 instances × 710 hours = 2,130 hrs @ $0.1749 = **$372**
- **Subtotal: $435**

### Monthly Costs

| Service | Machine Type | Cost | Notes |
|---------|--------------|------|-------|
| **Jitsi Videobridge (JVB)** | n2-standard-8 | **$2,016** | 25 peak + 6 baseline per region |
| **Jicofo** | e2-medium | **$147** | 6 instances, 24/7 |
| **Prosody** | e2-standard-2 | **$587** | 12 instances, 24/7 |
| **Nginx** | e2-small | **$74** | 6 instances, 24/7 |
| **TURN Servers** | n2-standard-4 | **$435** | 6 peak + 3 baseline per region |
| **Memorystore (Redis)** | Standard 5GB | **$318** | 3 regions |
| **Cloud SQL (PostgreSQL)** | db-n1-standard-2 | **$350** | Multi-regional |
| **Load Balancing** | Network + App LB | **$160** | 3 regions |
| **Bandwidth (Egress)** | Premium Tier | **$20,520** | 273.6 TB @ $0.075/GB |
| **Cloud NAT** | - | **$99** | 3 regions |
| **Cloud DNS** | - | **$5** | Hosted zones |
| **Cloud Storage** | Multi-regional | **$10** | Recordings |
| **Monitoring & Logging** | - | **$30** | Monitoring |
| | | | |
| **GRAND TOTAL** | | **$24,751/month** | |

**Cost per session:** $247.51

---

## Jitsi Component Breakdown

### Why These Machine Types?

| Component | Type | Why? | Capacity | Always On? |
|-----------|------|------|----------|------------|
| **JVB** | n2-standard-8 | Media forwarding (SFU), needs CPU + network | 1-2 rooms, 2,500 forwards | Auto-scaled |
| **Jicofo** | e2-medium | Lightweight coordination logic | 50-100 rooms | Yes (24/7) |
| **Prosody** | e2-standard-2 | XMPP connections, memory for state | 5,000-10,000 connections | Yes (24/7) |
| **Nginx** | e2-small | Static assets (behind CDN) | 1,000+ connections | Yes (24/7) |
| **TURN** | n2-standard-4 | Network relay | 200-300 users | Auto-scaled |

### Key Differences from LiveKit

**More complex architecture:**
- LiveKit: 1 service (media server) + Redis
- Jitsi: 4 services (JVB + Jicofo + Prosody + Nginx) + Redis + PostgreSQL

**More always-on components:**
- Jicofo, Prosody, and Nginx run 24/7 (can't auto-scale easily)
- Adds ~$808/month in baseline compute costs

**Slightly higher operational complexity:**
- More services to monitor and maintain
- More potential failure points
- XMPP can be tricky to debug

---

## Cost Comparison

| Solution | Monthly Cost |
|----------|--------------|
| **Cloud (Daily.co)** | **$24,000** |
| **Self-Hosted (Scenario A)** | **$24,280** |
| **Self-Hosted (Scenario B)** | **$29,008** |
| **Self-Hosted (Scenario C)** | **$24,751** |
