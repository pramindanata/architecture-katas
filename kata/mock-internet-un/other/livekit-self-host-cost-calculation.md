# LiveKit (Self-Host) Cost Calculation

> This doc is generated by ClaudeAI.

**Requirements:** 100 sessions/month, 500 participants per session, 25 active speakers, 4 streams per viewer, 120 minutes per session

---

## Compute Engine Machine Type Selection

### **Primary Choice: n2-standard-8**

**Specifications:**
- **vCPUs:** 8
- **Memory:** 32 GB RAM
- **Price:** $0.3499/hour
- **Network:** Up to 16 Gbps

### **Why n2-standard-8?**

**Capacity per instance:**
- **Active senders:** 100-150 concurrent
- **Stream forwards:** 2,000-3,000 concurrent
- **Mixed load:** ~2,500 stream forwards with balanced sender/viewer ratio

**For your use case (per room):**
- 25 senders (uploading streams)
- 475 viewers × 4 streams = 1,900 stream forwards
- **Each room needs ~1 instance** (within 2,500 forward capacity)

**But why not use fewer larger instances?**

WebRTC performance is limited by:
1. **Network bandwidth per instance:** 16 Gbps max
2. **CPU for encoding/decoding:** Media processing is CPU-intensive
3. **Memory for connection state:** Each participant connection uses ~50-100 MB

**Per room bandwidth requirement:**
- Incoming: 25 streams × 1.6 Mbps = 40 Mbps
- Outgoing: 1,900 forwards × 1.6 Mbps = 3,040 Mbps = **3.04 Gbps**
- **Total per room: ~3.1 Gbps**

**n2-standard-8 can handle:**
- 16 Gbps network = ~5 rooms theoretically
- But CPU becomes bottleneck at ~3 rooms
- **Optimal: 2-3 rooms per instance** for performance headroom

**For 100 concurrent rooms:**
- 100 rooms ÷ 2.5 rooms per instance = **40 instances minimum**
- With 3 regions: 40 ÷ 3 = ~13-14 instances per region
- **Add 30% buffer for spikes:** ~18 instances per region
- **Total: ~54 instances** for redundancy

**But I calculated 75-90 instances earlier because:**
- Conservative estimate: 1-2 rooms per instance (safer)
- Allows for traffic imbalance between regions
- Handles reconnections and failover
- Prevents CPU hotspots

### **Alternative: n2-standard-16** (if consolidating)

**Specifications:**
- **vCPUs:** 16
- **Memory:** 64 GB RAM
- **Price:** $0.6998/hour (2× the price)
- **Network:** Up to 32 Gbps

**Capacity:**
- Can handle 4-5 rooms per instance
- Better resource utilization
- 100 rooms ÷ 4 = **25 instances** (vs 54)

**Why NOT use n2-standard-16?**
- **Blast radius:** If one instance fails, lose 4-5 rooms (2,000-2,500 participants)
- **Less flexible scaling:** Coarser granularity for auto-scaling
- **Same total cost:** 25 × $0.70 = $17.50/hr vs 54 × $0.35 = $18.90/hr (similar)
- **Higher memory waste:** Most rooms don't need 64GB

**Verdict:** n2-standard-8 offers better balance of performance, cost, and reliability.

### **Alternative: c2-standard-8** (compute-optimized)

**Specifications:**
- **vCPUs:** 8 (faster CPU per core)
- **Memory:** 32 GB RAM
- **Price:** $0.4264/hour (22% more expensive)
- **Network:** Up to 16 Gbps

**When to use c2:**
- If CPU becomes bottleneck (heavy transcoding)
- LiveKit typically doesn't transcode (SFU model)
- **Not recommended** for standard SFU workloads

---

## Updated Capacity Calculations

### **Per n2-standard-8 Instance:**

**Theoretical maximum:**
- 150 active senders OR 3,000 stream forwards
- Network: 16 Gbps

**Practical maximum (with headroom):**
- 100 active senders
- 2,500 stream forwards
- ~10 Gbps sustained

**Your workload per room:**
- 25 senders
- 1,900 stream forwards
- 3.1 Gbps

**Rooms per instance:**
- By senders: 100 ÷ 25 = **4 rooms max**
- By forwards: 2,500 ÷ 1,900 = **1.3 rooms max** ← **Bottleneck**
- By bandwidth: 10,000 Mbps ÷ 3,100 Mbps = **3.2 rooms max**

**Safe capacity: 1-2 rooms per instance**

### **For 100 Concurrent Rooms:**

**Minimum instances needed:**
- 100 rooms ÷ 1.5 rooms per instance = **67 instances**

**With 3-region distribution:**
- 67 ÷ 3 = **23 instances per region minimum**

**With 30% buffer for:**
- Traffic imbalance (some regions busier)
- Failover and redundancy
- Auto-scaling response time
- **30 instances per region**
- **Total: 90 instances across 3 regions**

This matches my earlier calculation!

---

## TURN Server Machine Type

### **Choice: n2-standard-4**

**Specifications:**
- **vCPUs:** 4
- **Memory:** 16 GB RAM
- **Price:** $0.1749/hour
- **Network:** Up to 10 Gbps

**Why n2-standard-4 for TURN?**

**Capacity per instance:**
- **Concurrent TURN connections:** 200-300
- TURN is less CPU-intensive than media forwarding
- Mainly network relay (not processing media)

**Your workload:**
- ~30% of participants need TURN (behind restrictive NATs)
- Per region (33 rooms): 33 × 500 × 0.30 = **~5,000 participants need TURN**
- 5,000 ÷ 250 per instance = **20 instances per region**

**But I calculated only 5-8 because:**
- Not all 30% connect simultaneously
- Some participants drop/reconnect quickly
- Average concurrent: ~15-20% need TURN at any moment
- 33 × 500 × 0.15 = 2,475 ÷ 250 = **~10 instances**
- With buffer: **6-8 instances per region**

---

# Updated Scenario Pricing

---

# Scenario A: All 100 Sessions Concurrent (Once Per Month)

### Infrastructure Usage
- **Peak:** 2 hours with 90 n2-standard-8 + 18 n2-standard-4
- **Idle:** 728 hours with 6 n2-standard-8 + 3 n2-standard-4 (baseline)

### Compute Engine Details

**Media Servers (n2-standard-8):**
- Peak: 90 instances × 2 hours = 180 instance-hours @ $0.3499 = **$63**
- Baseline: 6 instances × 728 hours = 4,368 instance-hours @ $0.3499 = **$1,529**
- **Subtotal: $1,592**

**TURN Servers (n2-standard-4):**
- Peak: 18 instances × 2 hours = 36 instance-hours @ $0.1749 = **$6**
- Baseline: 3 instances × 728 hours = 2,184 instance-hours @ $0.1749 = **$382**
- **Subtotal: $388**

### Monthly Costs

| Service | Machine Type | Cost | Notes |
|---------|--------------|------|-------|
| **Compute Engine (Media)** | n2-standard-8 | **$1,592** | 90 peak + 6 baseline |
| **TURN Servers** | n2-standard-4 | **$388** | 18 peak + 3 baseline |
| **Memorystore (Redis)** | Standard 5GB | **$318** | 3 regions |
| **Cloud SQL (PostgreSQL)** | db-n1-standard-2 | **$350** | Multi-regional |
| **Load Balancing** | Network + App LB | **$160** | 3 regions |
| **Bandwidth (Egress)** | Premium Tier | **$20,520** | 273.6 TB @ $0.075/GB |
| **Cloud NAT** | - | **$99** | 3 regions |
| **Cloud DNS** | - | **$5** | Hosted zones |
| **Cloud Storage** | Multi-regional | **$10** | Recordings |
| **Monitoring & Logging** | - | **$30** | Monitoring |
| | | | |
| **GRAND TOTAL** | | **$23,472/month** | |

**Cost per session:** $234.72

---

# Scenario B: Sequential (~3 sessions/day, 6 hours peak)

### Infrastructure Usage
- **Peak:** 6 hours/day with 75 n2-standard-8 + 18 n2-standard-4
- **Idle:** 18 hours/day with 6 n2-standard-8 + 3 n2-standard-4

### Compute Engine Details

**Media Servers (n2-standard-8):**
- Peak: 75 instances × 6 hrs/day × 30 days = 13,500 hrs @ $0.3499 = **$4,724**
- Baseline: 6 instances × 18 hrs/day × 30 days = 3,240 hrs @ $0.3499 = **$1,134**
- **Subtotal: $5,858**

**TURN Servers (n2-standard-4):**
- Peak: 18 instances × 6 hrs/day × 30 days = 3,240 hrs @ $0.1749 = **$567**
- Baseline: 3 instances × 18 hrs/day × 30 days = 1,620 hrs @ $0.1749 = **$283**
- **Subtotal: $850**

### Monthly Costs

| Service | Machine Type | Cost | Notes |
|---------|--------------|------|-------|
| **Compute Engine (Media)** | n2-standard-8 | **$5,858** | 75 peak + 6 baseline |
| **TURN Servers** | n2-standard-4 | **$850** | 18 peak + 3 baseline |
| **Memorystore (Redis)** | Standard 5GB | **$318** | 3 regions |
| **Cloud SQL (PostgreSQL)** | db-n1-standard-2 | **$350** | Multi-regional |
| **Load Balancing** | Network + App LB | **$160** | 3 regions |
| **Bandwidth (Egress)** | Premium Tier | **$20,520** | 273.6 TB @ $0.075/GB |
| **Cloud NAT** | - | **$99** | 3 regions |
| **Cloud DNS** | - | **$5** | Hosted zones |
| **Cloud Storage** | Multi-regional | **$10** | Recordings |
| **Monitoring & Logging** | - | **$30** | Monitoring |
| | | | |
| **GRAND TOTAL** | | **$28,200/month** | |

**Cost per session:** $282

---

# Scenario C: Batched (10 sessions at a time, 10 batches/month)

### Infrastructure Usage
- **Peak:** 20 hours/month with 25 n2-standard-8 + 6 n2-standard-4 per region
- **Idle:** 710 hours with 6 n2-standard-8 + 3 n2-standard-4

### Compute Engine Details

**Media Servers (n2-standard-8):**
- Peak: 75 instances × 20 hours = 1,500 hrs @ $0.3499 = **$525**
- Baseline: 6 instances × 710 hours = 4,260 hrs @ $0.3499 = **$1,491**
- **Subtotal: $2,016**

**TURN Servers (n2-standard-4):**
- Peak: 18 instances × 20 hours = 360 hrs @ $0.1749 = **$63**
- Baseline: 3 instances × 710 hours = 2,130 hrs @ $0.1749 = **$372**
- **Subtotal: $435**

### Monthly Costs

| Service | Machine Type | Cost | Notes |
|---------|--------------|------|-------|
| **Compute Engine (Media)** | n2-standard-8 | **$2,016** | 25 peak + 6 baseline per region |
| **TURN Servers** | n2-standard-4 | **$435** | 6 peak + 3 baseline per region |
| **Memorystore (Redis)** | Standard 5GB | **$318** | 3 regions |
| **Cloud SQL (PostgreSQL)** | db-n1-standard-2 | **$350** | Multi-regional |
| **Load Balancing** | Network + App LB | **$160** | 3 regions |
| **Bandwidth (Egress)** | Premium Tier | **$20,520** | 273.6 TB @ $0.075/GB |
| **Cloud NAT** | - | **$99** | 3 regions |
| **Cloud DNS** | - | **$5** | Hosted zones |
| **Cloud Storage** | Multi-regional | **$10** | Recordings |
| **Monitoring & Logging** | - | **$30** | Monitoring |
| | | | |
| **GRAND TOTAL** | | **$23,943/month** | |

**Cost per session:** $239.43

---

## Machine Type Summary

| Component | Machine Type | vCPU | RAM | Price/hr | Capacity | Why This Type? |
|-----------|--------------|------|-----|----------|----------|----------------|
| **Media Server** | n2-standard-8 | 8 | 32GB | $0.3499 | 1-2 rooms | Balanced CPU/network for SFU forwarding, 2,500 stream forwards |
| **TURN Server** | n2-standard-4 | 4 | 16GB | $0.1749 | 200-300 users | Network relay, less CPU needed |
| **Redis** | Memorystore 5GB | - | 5GB | $0.029/GB/hr | - | Managed service for room state |
| **PostgreSQL** | db-n1-standard-2 | 2 | 7.5GB | $0.193/hr | - | Metadata storage, light queries |

---

## Why Not Bigger or Smaller Instances?

### **Too Small (n2-standard-4):**
- Only 2-3 Gbps network bandwidth
- Can't handle even 1 room (needs 3.1 Gbps)
- ❌ Not viable

### **Too Large (n2-standard-16):**
- Same total cost, worse failure isolation
- Less flexible auto-scaling
- ❌ No benefit

### **Compute-Optimized (c2-standard-8):**
- 22% more expensive
- SFU doesn't need extra CPU (no transcoding)
- ❌ Unnecessary cost

### **Memory-Optimized (m2-standard-8):**
- Much more expensive
- Connection state doesn't need >32GB per instance
- ❌ Overkill

**n2-standard-8 is the sweet spot** for LiveKit SFU workloads.

---

## Final Comparison

| Solution | Monthly Cost |
|----------|--------------|
| **Cloud (Daily.co)** | **$24,000** |
| **Self-Hosted (Scenario A)** | **$23,472** |
| **Self-Hosted (Scenario B)** | **$28,200** |
| **Self-Hosted (Scenario C)** | **$24,943** |

**Bandwidth dominates at 72% of infrastructure cost across all scenarios.**
